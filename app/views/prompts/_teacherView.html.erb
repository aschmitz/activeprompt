<script type="text/javascript">
  var halfHandleW,
      halfHandleH,
      promptImage,
      promptImageW,
      promptImageH,
      responses;
  
  function getPromptImageSize() {
    promptImageW = promptImage.width();
    promptImageH = promptImage.height();
  }
  
  $(window).load(function() {
    var sampleHandle = $('#sample_handle');
    halfHandleW = sampleHandle.width() / 2;
    halfHandleH = sampleHandle.height() / 2;
    
    promptImage = $('#prompt_image');
    getPromptImageSize();
    $(window).resize(getPromptImageSize);
    
    responses = new Firebase('https://activeprompt.firebaseio.com/<%=j firebaseId %>');
    
    responses.on('child_added', function(snapshot) {
      var ref = snapshot.ref();
      
      jQuery('<img/>', {
        id: ref.name(),
        src: "/assets/red_dot.png",
        style: "opacity: 0.7; filter:alpha(opacity=70); z-index: 1; position: absolute",
        text: snapshot.val().top + ' ' + snapshot.val().left,
      }).appendTo("#prompt_image_container");
      
      ref.on('value', function(snapshot) {
        var response = $("#" + snapshot.ref().name());
        
        if (!!snapshot.val()) {
          response.text(snapshot.val().top + ' ' + snapshot.val().left);
          
          response.css("left", ((snapshot.val().left * promptImageW) - halfHandleW) + "px");
          response.css("top", ((snapshot.val().top * promptImageH) - halfHandleH) + "px");
        } else {
          response.remove();
        }
      });
    });
  });
</script>